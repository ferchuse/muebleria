<?php	header("Content-Type: application/json");	include ("conex.php");	$link = Conectarse();	$tarjeta = $_GET["tarjeta"];	$response= array();		$query ="SELECT	nombre_cliente,	suma_cantidad_abono AS cantidad_abono,	suma_importe - suma_enganche - IF(ISNULL(total_abonado), 0, total_abonado) AS saldo_actual		FROM	ventas 		LEFT JOIN 	(	SELECT	tarjeta,	SUM(abono) AS total_abonado	FROM	abonos	WHERE	tarjeta = '$tarjeta'	) as t_abonado	USING(tarjeta)		LEFT JOIN 	(	SELECT	tarjeta,	SUM(cantidad_abono) AS suma_cantidad_abono,	SUM(importe) AS suma_importe,	SUM(enganche) AS suma_enganche	FROM	ventas	WHERE	tarjeta = '$tarjeta'	) as t_importe	USING(tarjeta)			WHERE tarjeta = '$tarjeta'  ";		$result=mysql_query($query,$link) or die("Error en: $query  ".mysql_error());		$response["existe"] = mysql_num_rows($result);	while($row = mysql_fetch_assoc($result)){				$response["datos_tarjeta"] = $row;	}		$q_ultimos_abonos ="		SELECT abono, 	DATE(fecha_hora_abono) AS fecha_abono	FROM	abonos	WHERE	tarjeta = '$tarjeta'	ORDER BY	fecha_hora_abono DESC	LIMIT 3";		$result_abonos=mysql_query($q_ultimos_abonos,$link) or die("Error en: $q_ultimos_abonos  ".mysql_error());		$response["hay_abonos"] = mysql_num_rows($result_abonos);		while($row = mysql_fetch_assoc($result_abonos)){				$response["ultimos_abonos"][] = $row;	}		echo json_encode($response);?>