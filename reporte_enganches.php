<?php	include "login/login_success.php";	include ("conex.php");	include ("is_selected.php");	$link = Conectarse();	$dias = array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado");	if($_GET["fecha_inicial"]){			$sector = $_GET["sector"];		$fecha_inicial = $_GET["fecha_inicial"];		$fecha_final = $_GET["fecha_final"];		}	else{		$dia_semana = date("w");			$dia_inicial = 5-$dia_semana;		$dia_final = 3 - $dia_semana ;				$fecha_inicial = date("d/m/Y",strtotime("-$dia_inicial days"));		$fecha_final = date("d/m/Y",strtotime("+$dia_final days"));		}		if(isset($_GET["estatus"])){		$estatus = $_GET["estatus"];	}	else{		$estatus = "TODOS";	}	if(isset($_GET["cobrador"])){		$cobrador = $_GET["cobrador"];	}	else{		$cobrador = "TODOS";	}?><html xmlns="http://www.w3.org/1999/xhtml"><head>	<title>Reporte de Enganches </title>	<meta charset="UTF-8" />	<?php include("styles.php");?>		<link rel="stylesheet" type="text/css" href="css/reporte_cobranza.css"  media="all"/>	</head><body><?phpinclude("header.php");?><div class="container-fluid">	<div class="visible-print">		Muebleria Casa Roberto	</div>	<div class='titulo no_imprimir'>Reporte de Enganches </div>	<div class="no_imprimir" id="div_form">		<form name="form_rep_mes"  class="form-inline" method="get" action="" onsubmit="return validar(this.name);"	>			<span class="form-group">				<label for="fecha_inicial" class="etiqueta">Fecha Inicial: </label>				<input size="10" class="form-control fecha" type="text" name="fecha_inicial" id="fecha_inicial" value="<?php echo $fecha_inicial;?>" />			</span>			<div class="form-group">				<label class="etiqueta"> Fecha Final: </label>				<input size="10" class="form-control fecha" type="text" name="fecha_final" id="fecha_final" value="<?php echo $fecha_final;?>" />			</div>			<div class="form-group hide">				<label class="etiqueta">					Cobrador: 				</label>				<select name="cobrador" id="cobrador" disabled class="form-control">									<?php 					$q_cobradores = "SELECT * FROM cobradores ORDER BY nombre_cobrador";					$result_cobradores=mysql_query($q_cobradores,$link) or die("Error en: $q_cobradores  ".mysql_error());										while($row = mysql_fetch_assoc($result_cobradores)){						$cobrador_db = $row["nombre_cobrador"];											?>					<option value="<?php echo $cobrador_db;?>" 						<?php echo is_selected($cobrador_db, $cobrador);?> > 						<?php echo $cobrador_db;?> 						</option>					<?php					}					?>				</select>			</div>							<button name="buscar" class="btn btn-success">				<i class="fa fa-search"></i> Buscar			</button>		</form>	</div>	<?php 	if(isset($_GET["buscar"])){						$q_abonos = "SELECT ventas.fecha_venta, estatus.estatus, ventas.clave_vendedor, tipo_abono, sector,hora_sync,folio,fecha_hora_abono, abonos.tarjeta, nombre_cliente,abonos.saldo_anterior, 		abonos.abono, abonos.saldo_restante, abonos.cobrador		FROM abonos 		LEFT JOIN ventas ON		ventas.tarjeta = abonos.tarjeta 		LEFT JOIN estatus 		USING (id_estatus)		WHERE DATE(fecha_hora_abono) BETWEEN STR_TO_DATE('$fecha_inicial', '%d/%m/%Y')		AND STR_TO_DATE('$fecha_final', '%d/%m/%Y')		AND tipo_abono = 'Enganche'				UNION				SELECT ventas.fecha_venta, estatus.estatus, ventas.clave_vendedor, tipo_abono, sector,hora_sync,folio,fecha_hora_abono, abonos.tarjeta, nombre_cliente,abonos.saldo_anterior, 		abonos.abono, abonos.saldo_restante, abonos.cobrador		FROM abonos 		LEFT JOIN ventas ON		ventas.tarjeta = abonos.tarjeta 		LEFT JOIN estatus 		USING (id_estatus)		WHERE DATE(fecha_hora_abono) BETWEEN STR_TO_DATE('$fecha_inicial', '%d/%m/%Y')		AND STR_TO_DATE('$fecha_final', '%d/%m/%Y')		AND abonos.cobrador LIKE '%ENGANCHES%'				UNION				SELECT ventas.fecha_venta, estatus.estatus, ventas.clave_vendedor, tipo_abono, sector,hora_sync,folio,fecha_hora_abono, abonos.tarjeta, nombre_cliente,abonos.saldo_anterior, 		abonos.abono, abonos.saldo_restante, abonos.cobrador		FROM abonos 		LEFT JOIN ventas ON		ventas.tarjeta = abonos.tarjeta 		LEFT JOIN estatus 		USING (id_estatus)		WHERE DATE(fecha_venta) BETWEEN STR_TO_DATE('$fecha_inicial', '%d/%m/%Y')		AND STR_TO_DATE('$fecha_final', '%d/%m/%Y')			";						if($cobrador != "TODOS" ){			$q_abonos.=  " AND abonos.cobrador= '$cobrador'";		}		if($estatus != "TODOS" ){			$q_abonos.=  " AND id_estatus= '$id_estatus'";		}						$q_abonos.= " AND tipo_abono <>'Devolución'			ORDER BY fecha_hora_abono, tarjeta";				$result_abonos=mysql_query($q_abonos,$link) or die("Error en: $q_abonos  ".mysql_error());			$num_rows = mysql_num_rows($result_abonos);		if($num_rows == 0){			echo "<div class='titulo'>No hay registros </div>"; 		}else{								?>		<h4 class="visible-print">			<div class="row">				<div class="col-sm-6">					Reporte de Cobranza del : <?php echo $fecha_inicial." al ".$fecha_final;  ?>  				</div>				<div class="col-sm-6">					Cobrador :  <?php echo $cobrador;?>   				</div>			</div>			<div class="row">				<div class="col-sm-6">					Tarjetas Cobradas :  <?php echo $num_rows;?>				</div>				<div class="col-sm-6">									</div>			</div>		</h4>				<div class="btn_imprimir no_imprimir">			<button type="button" class="btn btn-primary" onclick="javascript:window.print();">				<i class="fa fa-print"> </i> Imprimir			</button>			<button type="button" class="btn btn-success btn_exportar" >				<i class="fa fa-arrow-right"> </i> Exportar			</button>		</div>				<table border="1" id="tabla_reporte" class="tabla_reporte">			<thead>				<th>Folio</th>				<th>Fecha Venta</th>				<th>Fecha Abono</th>				<th>Tarjeta</th>				<th>Nombre Cliente</th>				<th>Saldo Anterior</th>				<th>Abono</th>				<th>Saldo Restante</th>				<th>Vendedor</th>				<th>Cobrador</th>				<th>Dia de Cobro</th>				<th>Sector</th>				<th>Estatus</th>			</thead>			<tbody>						<?php								$sum_abonos = array();		$contador = 1;				while($row = mysql_fetch_assoc($result_abonos)){			$fecha_hora_abono = $row["fecha_hora_abono"];					$fecha_abono = date("d/m/Y", strtotime($row["fecha_hora_abono"]));					$fecha_venta = date("d/m/Y", strtotime($row["fecha_venta"]));					$hora = date("H:i:s", strtotime($row["fecha_hora_abono"]));					$hora_sync = $row["hora_sync"];					$tarjeta = $row["tarjeta"];			$folio = $row["folio"];			$clave_vendedor = $row["clave_vendedor"];			$nombre_cliente = $row["nombre_cliente"];			$saldo_anterior = $row["saldo_anterior"];			$abono = $row["abono"];			$estatus = $row["estatus"];			$saldo_restante = $row["saldo_restante"];			$sum_abonos[] = $abono;			$cobrador_db = $row["cobrador"];			$dia_cobranza = $row["dia_cobranza"];			$dia_numerico = date("w", strtotime($row["fecha_hora_abono"])) ;			$sector = $row["sector"] ;			$tipo_abono = $row["tipo_abono"] ;			//$dias = array("Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado");					?>			<tr>				<td><?php echo "$contador";?></td>				<td><?php echo $fecha_venta;?></td>				<td><?php echo "$fecha_abono";?></td>								<td>					<a target="_blank" href="buscar_tarjeta.php?tarjeta=<?php echo "$tarjeta";?>" ><?php echo "$tarjeta";?> <a/>				</td>								<td>					<?php echo "$nombre_cliente";?>				</td>								<td>					<?php echo "$ $saldo_anterior";?>				</td>				<td>					<?php echo  "$ $abono";?>				</td>				<td>					<?php echo "$ $saldo_restante";?>				</td>				<td><?php echo $row["clave_vendedor"];;?></td>				<td>					<?php echo " $cobrador_db";?>				</td>				<td>					<?php echo $dias[$dia_numerico];?>				</td>				<td>					<?php echo $sector;?>				</td>				<td>					<?php echo $estatus;?>				</td>			</tr>		<?php			$contador++;		}		?>		<tr>				<td><?php $contador; 	?> </td>			<td>-</td>			<td>-</td>			<td>-</td>			<td>-</td>			<td>-</td>						<td>				<b><?php echo  "$ ".number_format(array_sum($sum_abonos),2);?></b>			</td>			<td>-</td>			<td>-</td>			<td>-</td>			<td>-</td>			<td>-</td>			<td>-</td>		</tr>		</tbody>			</table>		<?php		}	}	?>	</div><?php include("scripts.php");?>	<script>	$( document ).ready(function() {		$(".btn_exportar").click(function(){						$('#tabla_reporte').tableExport(			{				type:'excel',				tableName:'Registros',				escape:'false'			});		});	}); 	</script></body></html>