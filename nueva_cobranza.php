<?phpinclude "login/login_success.php";include ("is_selected.php");include ("conex.php");$link = Conectarse();if(isset($_GET["editar"])){	$fecha_hora_abono = $_GET["fecha_hora_abono"];	$fecha_abono = substr( $fecha_hora_abono ,0 , 10);	$fecha_abono = date("d/m/Y", strtotime($fecha_abono));		$hora_abono = substr($fecha_hora_abono  ,10);	$cobrador = $_GET["cobrador"];	$tarjeta = $_GET["tarjeta"];}elseif(isset($_GET["agregar"])){	$fecha_abono = date("d/m/Y");	$cobrador =  $_GET["cobrador"];	$tarjeta = $_GET["tarjeta"];}else{	$fecha_abono = date("d/m/Y");	$cobrador =  "";}?><!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" /><meta name="HandheldFriendly" content="true" /><title>Registrar Cobranza</title><?php include("styles.php");?></head><body><?phpinclude("header.php");?><div class="container-fluid">	<div class="titulo">		Registrar Cobranza	</div> 	<form  action="" method="post" id="form_nueva_cobranza" accept-charset="utf-8">		<div>			<table class="table">				<tr>					<td>						 Fecha 					</td>					<td>						 Cobrador 					</td>					<td>						 Hora						</td>					<td>						 Tipo de Abono						</td>					<td>						 Tarjeta					</td>					<td>						 Cliente					</td>					<td>						 Saldo Anterior					</td>					<td>						 Abono					</td>					<td>						Saldo Restante					</td>					<td>											</td>				</tr>				<tr>					<td >						<input type="text"  id="txt_fecha_abono" name="fecha_abono" size="10" value="<?php echo $fecha_abono;?>" />					</td>					<td  >						<select name="cobrador" id="select_cobrador">							<option value="" <?php echo is_selected("", $cobrador)?> >Elige un Cobrador	</option>							<?php 								$q_cobradores = "SELECT * FROM cobradores ORDER BY nombre_cobrador";								$result_cobradores=mysql_query($q_cobradores,$link) or die("Error en: $q_cobradores  ".mysql_error());																while($row = mysql_fetch_assoc($result_cobradores)){									$cobrador_db = $row["nombre_cobrador"];																	?>								<option value="<?php echo $cobrador_db;?>" 									<?php echo is_selected($cobrador_db, $cobrador);?> > 									<?php echo $cobrador_db;?> 									</option>								<?php								}								?>							</select>					</td>					<td >					  <input type="text"  id="txt_hora_abono" pattern="([01]?[0-9]|2[0-3])(:[0-5][0-9]){2}" 						required="required" placeholder="hh:mm:ss" name="hora_abono" size="10" value="<?php echo $hora_abono;?>" />					</td>					<td >						<select name="tipo_abono" id="tipo_abono">							<option value="Abono" >Abono	</option>							<option value="Enganche" >Enganche	</option>							<option value="Ajuste" >Ajuste	</option>								</select>					</td>					<td >					  <input type="text"  id="txt_tarjeta" autofocus name="tarjeta" size="5" value="<?php echo $tarjeta;?>"  />					</td>					<td >					  <input type="text"  id="txt_nombre_cliente" readonly name="cliente" size="25"   />					</td>					<td class="form-input">					  <input type="text" id="txt_saldo_anterior" readonly name="saldo_anterior" size="10" />					</td>					<td >					  <input type="text" id="txt_abono" name="abono" size="10" value="" />					</td>					<td >					  <input type="text" id="txt_saldo_restante" readonly name="saldo_restante" size="10"  />					</td>					<td >					  <button class="btn_add btn btn-success" name="guardar" id="btn_guardar">								<i class="fa fa-save"></i> Guardar		 						</button>					</td>				</tr>			</table>		</div>	</form></div><?php include("scripts.php");?><script type="text/javascript">$( document ).ready(function() {		var dt = new Date();	var time = dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();	$("#txt_hora_abono").val(time);		$("#txt_fecha_abono").datepicker({		changeMonth: true,		changeYear: true,		minDate: -1,		onSelect: function(dateText, inst) {			$("#txt_tarjeta").select();		}	});	// $('#txt_fecha_abono').focus();			//evita enviar el formulario el presionar enter	 $('#form_nueva_cobranza').keypress(function(e){   		if(e.which == 13){		  return false;		}			 }); 	 	$( "#txt_abono" ).blur(function() {		var saldo_anterior = $( "#txt_saldo_anterior" ).val();		var abono = $( "#txt_abono" ).val();		$( "#txt_saldo_restante" ).val(parseInt(saldo_anterior) - abono);	});		$( "#txt_tarjeta" ).blur(function() {		if($( "#txt_tarjeta" ).val() == ""){						alertify.error("Ingresa una Tarjeta");					}		else{			var tarjeta = $( "#txt_tarjeta" ).val();			$.get("get_saldo_actual.php",  { "tarjeta":tarjeta  } , function(respuesta, status){								if(status =="success"){					console.log(respuesta);					if(respuesta["existe"]){						$("#txt_nombre_cliente").val(respuesta.datos_tarjeta.nombre_cliente);											$("#txt_abono").val(respuesta.datos_tarjeta.cantidad_abono);							$("#txt_saldo_anterior").val(respuesta.datos_tarjeta.saldo_actual);							$("#articulo").val(respuesta.datos_tarjeta.articulo);							$("#txt_abono").focus();						}					else{						alertify.error("Tarjeta No Encontrada");						$("#txt_nombre_cliente").val("");													$("#txt_tarjeta").focus();								$("#txt_tarjeta").select();						}												}			});		}			});	  	$('#btn_guardar').click(function(event){		//alert("Guardadno");		event.preventDefault();				if (validar("form_nueva_cobranza")){			$.post("guardar_cobranza.php", $( "#form_nueva_cobranza" ).serialize(), function(data_return, status){				alertify.success(data_return);								//regresa todos los valores a 0				if(status =="success"){										$("#txt_tarjeta").val("");					$("#txt_saldo_anterior").val("");					$("#txt_abono").val("");					$("#txt_saldo_restante").val("");					$("#txt_nombre_cliente").val("");															var dt = new Date();					var time = dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();					$("#txt_hora_abono").val(time);										$("#txt_tarjeta").focus();									}			});		}	});  		$("#txt_saldo_restante").keypress(function(e){		if(e.which == 13){			$('#btn_guardar').click();		}	});}); </script></body></html>