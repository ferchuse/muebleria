<?php	include "login/login_success.php";	include ("conex.php");	include ("is_selected.php");	$link = Conectarse();	$meses = array("ENE","FEB","MAR","ABR","MAY","JUN","JUL", "AGO", "SEP", "OCT", "NOV", "DIC");		if(isset($_GET["year"])){		$year = $_GET["year"];	}	else{		$year = date("Y");	}?><!DOCTYPE html><html>	<head>		<title>Reporte de Ventas </title>		<meta charset="UTF-8" />		<?php include("styles.php");?>	</head>	<body>		<?php			include("header.php");		?>		<div class="container-fluid">			<div class="visible-print">				Muebleria Casa Roberto			</div>			<div class='titulo no_imprimir'>Reporte de Ventas </div>			<div class="no_imprimir" >				<form name="form_rep_mes"  class="form-inline" method="get" action="" >					<span class="form-group">						<label for="fecha_inicial" class="etiqueta">Año: </label>						<select class="form-control" name="year" id="fecha_inicial">							<?php 								for($año = 2017; $año < 2040; $año++ ){?>								<option 	<?php echo is_selected($year, $año);?>   value="<?php echo $año?>"><?php echo $año;?></option>								<?php 								}							?>						</select>					</span>					<button type="submit" class="btn btn-success">						<i class="fa fa-search"></i> Buscar					</button>				</form>			</div>						<?php 				if(isset($_GET["year"])){										$q_ventas = "SELECT					MONTH(fecha_venta) AS mes,					SUM(importe) AS importe_mensual					FROM					ventas					WHERE 					YEAR(fecha_venta) = '$year'					GROUP BY					MONTH(fecha_venta)					";										$result_ventas=mysql_query($q_ventas,$link) or die("Error en: $q_ventas_por_vendedor  ".mysql_error());									?>				<section>					<div class="row">						<div class="col-sm-12">							<div class="row">								<div class="col-sm-6">									<h4 class="">	Reporte de Ventas Año: <?php echo $year;  ?> 	</h4> 								</div>								<div class="col-sm-6 text-right hidden-print">									<button type="button" class="btn btn-primary" onclick="javascript:window.print();">										<i class="fa fa-print"> </i> Imprimir									</button>									<button type="button" class="btn btn-success btn_exportar" >										<i class="fa fa-arrow-right"> </i> Exportar									</button>								</div>							</div>							<div class="row">								<div class="col-sm-6 col-xs-3 text-center">									<table border="1" id="tabla_reporte" class="tabla3 tabla_grafica">										<thead>											<th>Mes</th>											<th>Acumulado</th>										</thead>										<tbody>											<?php												$suma_importes = array();																								while($row = mysql_fetch_assoc($result_ventas)){													$importe_total = $row["importe_mensual"];														$suma_importes[] = $row["importe_mensual"];													$index_mes = $row["mes"] - 1;												?>												<tr>													<td>														<?php echo $meses[$index_mes];?>													</td>													<td class="text-right">														<?php echo number_format($importe_total, 2) ;?>													</td>												</tr>												<?php												}											?>																					</tbody>											<tfoot>											<tr>													<th>Total Anual </th>												<th><?php echo number_format(array_sum($suma_importes), 2);?></th>											</tr>										</tfoot>									</table>								</div>								<div class="col-sm-5 col-xs-7 text-center">									<canvas id="grafica">									</canvas>								</div>							</div>														<?php							}						?>					</div>						</div>					</section>					<?php 				if(isset($_GET["year"])){					$q_vendedores = "SELECT DISTINCT(clave_vendedor) FROM ventas WHERE YEAR(fecha_venta) = '$year'";					$result_vendedores=mysql_query($q_vendedores,$link) or die("Error en: $q_vendedores  ".mysql_error());														?>				<hr>				<section>					<div class="row">						<div class="col-sm-12">							<div class="row">								<div class="col-sm-6">									<h4 class="etiqueta"> Reporte de Ventas Por Vendedor Año: <?php echo $year;  ?>  </h4>								</div>								<div class="col-sm-6 text-right hidden-print">									<button type="button" class="btn btn-primary" onclick="javascript:window.print();">										<i class="fa fa-print"> </i> Imprimir									</button>									<button type="button" class="btn btn-success btn_exportar" >										<i class="fa fa-arrow-right"> </i> Exportar									</button>								</div>							</div>																												<table border="1" class="tabla_reporte" class="">								<thead>									<th>Vendedor</th>									<?php 										foreach($meses AS $index_mes => $mes){?>										<th><?php echo $mes?></th>										<?php 										}									?>									<th>Total Mensual</th>								</thead>								<tbody>									<?php										$suma_mensual = array();										$suma_anual = array();										while($row = mysql_fetch_assoc($result_vendedores)){																						$suma_vendedor = array();																						$clave_vendedor = $row["clave_vendedor"];											$q_ventas = "SELECT											*											FROM ";											foreach($meses as $index => $mes ){												$num_mes = $index + 1;												$q_ventas.= "(												SELECT												SUM(importe) AS $mes												FROM												ventas												WHERE												YEAR (fecha_venta) = '$year'												AND MONTH (fecha_venta) = ".$num_mes." 												AND clave_vendedor = '$clave_vendedor'												) AS $mes,";											}											$q_ventas = trim($q_ventas, ",");																																												$result_ventas=mysql_query($q_ventas,$link) or die("Error en: **$q_ventas***  ".mysql_error());																																	while($row = mysql_fetch_assoc($result_ventas)){																																			?>																						<tr>												<td><?php echo $clave_vendedor;?></td>												<?php 													foreach($meses AS $index_mes => $mes){?>													<td class="text-right"><?php echo  number_format($row[$mes], 2);?></td>													<?php 														$suma_vendedor[] = $row[$mes];														$suma_mensual[$index_mes][] = $row[$mes];														$suma_anual[] = $row[$mes];													}												?>												<td class="text-right"><?php echo number_format(array_sum($suma_vendedor), 2) ;?></td>											</tr>											<?php											}										}									?>									<tr>											<th>Total General </th>										<?php 											foreach($meses AS $index_mes => $mes){?>											<td class="text-right">												<b><?php echo  number_format(array_sum($suma_mensual[$index_mes]), 2);?></b>											</td>											<?php 											}										?>										<td class="text-right"><b><?php echo number_format(array_sum($suma_anual), 2);?></b></td>									</tr>								</tbody>									</table>							<?php							}						?>					</div>				</div>			</section>		</div>				<?php include("scripts.php");?>		<script src="js/chart.min.js"></script>		<script>			$( document ).ready(function() {				$(".btn_exportar").click(function(){										$(this).closest("section").find("table").tableExport({						type:'excel',						tableName:'Registros',						escape:'false'					});				});								var labels = [];				var data = Array();								$(".tabla_grafica").find("tbody").find("tr").each(function(index, element){					labels.push($(element).find("td").first().html());					data.push(parseFloat($.trim($(element).find("td").last().html()).replace(/,/g,'')));					//data.push($(element)[1].innerHTML.trim());					console.log("Filas");					console.log(element);				});								//console.log($("#tabla_grafica").find("tbody").find("tr"));				console.log("labels");				console.log(labels);								console.log("data");				console.log(data);												var chart_data = {					"labels": labels, //["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],					"datasets": [{            "label": 'Acumulado de Ventas',            "data": data, //[12, 19, 3, 5, 2, 3],            "borderWidth": 1					}]				};				canvas = $("#grafica");								var chart = new Chart(canvas, {					"type": 'bar',					"data": chart_data,					options: {						animation: false,						//categoryPercentage: 1,						scales: {							yAxes: [{								ticks: {									beginAtZero:true								}							}],							xAxes: [{								"stacked": true,								//"barThickness": 30,								ticks: {									autoSkip: false,									maxRotation: 90,									minRotation: 90								}							}]						}					}				});				/* var myChart = new Chart(ctx, {					type: 'bar',					data: chartData,					options: {					scales: {					xAxes: [{					ticks: {					autoSkip: false,					maxRotation: 90,					minRotation: 90					}					}]					}					} 				});*/							}); 		</script>			</body></html>