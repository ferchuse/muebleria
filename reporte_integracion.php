<?php	//include "login/login_success.php";	include ("conex.php");	include ("is_selected.php");	$link = Conectarse();	$dias = array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado");	//$arr_estatus = array("Al Corriente","Atraso","Negativa de Pago","Ilocalizada","Ilocalizada Año Actual",	//"Ilocalizada Años Anteriores","Tarjeta Nueva", "Salvedades", "Liquidada", "Devolución de Mercancia", "Notificada al Supervisor");	$arr_estatus = Array();		//setlocale(LC_TIME, "es_ES");	//$dia_inicial = $dia_semana["wday"] -1;	//$dia_final = 6 - $dia_semana["wday"] ;	if(isset( $_GET["cobrador"])){		$cobrador = $_GET["cobrador"];		$sector = $_GET["sector"];	}	else{		$cobrador = "MUEBLERIA";		$sector = "";			}	if(isset( $_GET["grupo_estatus"])){		$grupo_estatus = $_GET["grupo_estatus"];		$q_estatus = "SELECT * FROM estatus WHERE grupo_estatus = '$grupo_estatus' ";		$result_estatus=mysql_query($q_estatus,$link) or die("Error en: $q_estatus  ".mysql_error());				while($row = mysql_fetch_assoc($result_estatus)){			$estatus = $row["estatus"];			$arr_estatus[] = "'$estatus'";		}				$in_estatus = implode( "," ,$arr_estatus);			}	else{		$grupo_estatus = "";	}		?><?php 	?><!DOCTYPE html><html lang="es">	<head>		<title>Integración de Cuentas </title>		<meta charset="utf-8" />				<?php include("styles.php");?>			</head>	<body>		<?php			include("header.php");		?>		<div class="contenido">			<div class="encabezado_imprimir">				Muebleria Casa Roberto			</div>			<div class='titulo no_imprimir'>INTEGRACIÓN  DE CUENTAS  </div>			<div class="no_imprimir" id="div_form">				<form name="form_rep_mes"  class="form-inline" method="get" action="" 	>										<div class="form-group">						<label class="etiqueta control-label">							Cobrador: 						</label>						<select name="cobrador" id="cobrador" required class="form-control">							<option value="" >Elige...</option>							<?php 								$q_cobradores = "SELECT * FROM cobradores  WHERE activo = 1 ORDER BY nombre_cobrador";								$result_cobradores=mysql_query($q_cobradores,$link) or die("Error en: $q_cobradores  ".mysql_error());																while($row = mysql_fetch_assoc($result_cobradores)){									$cobrador_db = $row["nombre_cobrador"];																	?>								<option value="<?php echo $cobrador_db;?>" 								<?php echo is_selected($cobrador_db, $cobrador);?> > 									<?php echo $cobrador_db;?> 									</option>								<?php								}							?>						</select>					</div>					<div class="form-group">						<label class="etiqueta control-label">							Estatus: 						</label>						<select name="grupo_estatus" id="grupo_estatus" required class="form-control">							<option value="TODAS">TODAS</option>							<?php 								$q_grupo = "SELECT DISTINCT(grupo_estatus) AS grupo_estatus FROM estatus";								$result_grupo=mysql_query($q_grupo,$link) or die("Error en: $q_grupo  ".mysql_error());																while($row = mysql_fetch_assoc($result_grupo)){									$grupo_estatus_db = $row["grupo_estatus"];																	?>								<option <?php echo is_selected($grupo_estatus, $grupo_estatus_db);?>  value="<?php echo $grupo_estatus_db;?>" > 									<?php echo $grupo_estatus_db;?> 									</option>								<?php								}							?>						</select>					</div>										<button name="buscar" class="btn btn-success">						<i class="fa fa-search"></i> Buscar					</button>				</form>			</div>			<hr>									<?php 				if(isset($_GET["buscar"])){									?>								<div class='titulo'>INTEGRACIÓN DE CUENTAS  </div>								<div class='titulo'>COBRADOR:  <?php echo "$cobrador";?>	 </div>				<div class='titulo'>FECHA DEL REPORTE:  <?php echo date("d/m/Y");?>	 </div>								<div class="row no_imprimir">															<div class="pull-right no_imprimir">						<button class="btn btn-info" onclick="javascript:window.print();">							<i class="fa fa-print"></i> Imprimir						</button>						<button type="button" class="btn btn-default exportar" >							<i class="fa fa-file-excel-o"></i> Exportar a Excel						</button>					</div>				</div>				<hr>				<div class="row">					<div class="col-sm-12">						<table border="1" id="table_export" class="tabla_grande">							<thead>									<th>ESTATUS</th>								<th>NUM DE TARJETAS</th>								<th>SUMA DE ABONO SEMANAL</th>								<th>IMPORTE DE VENTA</th>								<th>COBRANZA</th>								<th>SUMA DE SALDO ACTUAL</th>							</thead>									<tbody>										<?php									$total_tarjetas = array();									$total_abonos = array();									$total_saldos = array();									$total_saldo_incial = array();									$total_cobrado = array();																		$q_integracion = "SELECT 									id_estatus,									estatus.estatus,									COUNT(tarjeta) AS num_tarjetas,									SUM(cantidad_abono) AS sum_abono_semanal,									SUM(saldo_actual) AS sum_saldo_actual,									SUM(importe) AS sum_importe_total,									SUM(importe - saldo_actual) AS sum_abonado									FROM									ventas									LEFT JOIN (																		SELECT									id_estatus,									tarjeta,									SUM(abono) AS total_abonado									FROM									abonos									GROUP BY id_estatus									) as t_abonado									USING 									LEFT JOIN estatus									USING (id_estatus)									WHERE									cobrador = '$cobrador' ";																											if($grupo_estatus != "TODAS"){																				$q_integracion.= " AND grupo_estatus = '$grupo_estatus'";																			}																			$q_integracion.= " GROUP BY id_estatus";																																													$result_integracion = mysql_query($q_integracion,$link) or die("Error en: $q_integracion  ".mysql_error());									while($row = mysql_fetch_assoc($result_integracion)){																				$estatus = $row["estatus"];										$num_tarjetas = $row["num_tarjetas"];										$sum_abono_semanal = $row["sum_abono_semanal"];										$sum_saldo_actual = $row["sum_saldo_actual"];										$sum_importe_total = $row["sum_importe_total"];										$sum_abonado = $row["sum_abonado"];										//$sum_abonado =  $sum_saldo_inicial - $sum_saldo_actual ;																														if ($estatus == "Devolución de Mercancia" || $estatus == "Liquidada" ){																						$texto_rojo = "texto_rojo";										}										else{											$total_abonos[] = $sum_abono_semanal;											$total_saldos[] = $sum_saldo_actual;											$total_importe[] = $sum_importe_total;											$total_cobrado[] = $sum_abonado;											$texto_rojo = "";											$total_tarjetas[] = $num_tarjetas;										}									?>																		<tr  >																				<td class="<?php echo $texto_rojo;?>"> <a href="ventas.php?cobrador=<?php echo "$cobrador";?>&estatus=<?php echo $row["estatus"];?>&id_estatus=<?php echo $row["id_estatus"];?>" target="_blank"> <?php echo "$estatus";?> </a>		</td>										<td class="number_format <?php echo $texto_rojo;?>"> <?php echo "$num_tarjetas";?>		</td>										<td class="number_format <?php echo $texto_rojo;?>"> 	<?php echo  number_format($sum_abono_semanal,2);?>	</td>										<td  class="number_format  <?php echo $texto_rojo;?>"> 	<?php echo  number_format($sum_importe_total,2);?>	</td>										<td  class="number_format  <?php echo $texto_rojo;?>"> 	<?php echo  number_format($sum_abonado,2);?>	</td>										<td  class="number_format  <?php echo $texto_rojo;?>"> 	<?php echo  number_format($sum_saldo_actual,2);?>	</td>									</tr>									<?php									}																		//echo $q_integracion;																	?>								<tr class="lead">									<th>										TOTAL GENERAL									</th>									<th class="number_format"> 										<?php echo  array_sum($total_tarjetas);?>									</th>									<th class="number_format"> 										<?php echo  "$ ".number_format(array_sum($total_abonos),2);?>									</th>									<th class="number_format"> 										<?php echo  "$ ".number_format(array_sum($total_importe),2);?>									</th>									<th class="number_format"> 										<?php echo  "$ ".number_format(array_sum($total_cobrado),2);?>									</th>									<th class="number_format"> 										<?php echo  "$ ".number_format(array_sum($total_saldos),2);?>									</th>																	</tr>							</tbody>								</table>																		<?php						} //END if is set boton buscar					?>									</div>			</div>		</div>				<?php include("scripts.php");?>		<script>						$( document ).ready(function() {								$(".exportar").click(function(){					console.log("Exportando");					$('#table_export').tableExport({						type:'excel',						tableName:'ReporteCobranza',						filName:'ReporteCobranza',												escape:'false'					});														});												function validar(){					txt_f_i= $("#fecha_inicial").val();					txt_f_f= $("#fecha_final").val();										if (txt_f_i == ''){						alert("Ingresa una Fecha Inicial") ;						return false;					}					if (txt_f_f == ''){						alert("Ingresa una Fecha Final") ;						return false;					}					return true	;					}											});		</script>					</body></html>