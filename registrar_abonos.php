<?php	include "login/login_success.php";	include ("is_selected.php");	include ("conex.php");	$link = Conectarse();		if(isset($_GET["editar"])){				$fecha_hora_abono = $_GET["fecha_hora_abono"];		$fecha_abono = substr( $fecha_hora_abono ,0 , 10);		$fecha_abono = date("d/m/Y", strtotime($fecha_abono));			$hora_abono = substr($fecha_hora_abono  ,10);		$cobrador = $_GET["cobrador"];						$tarjeta = $_GET["tarjeta"];	}	elseif(isset($_GET["agregar"])){				$hora_abono = date("H:i:s");		$fecha_abono = date("d/m/Y");		$cobrador =  $_GET["cobrador"];		$tarjeta = $_GET["tarjeta"];			}	else{		$fecha_abono = date("d/m/Y");		$hora_abono = date("H:i:s");		$cobrador =  "MATRIZ";	}	?><!DOCTYPE html><html><head>	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />	<meta name="HandheldFriendly" content="true" />	<title>Registrar Abono</title>	<link rel="stylesheet" type="text/css" href="css/layout.css" />	<link rel="stylesheet" type="text/css" href="css/layout.css"  media="print"/>			<link rel="stylesheet" type="text/css" href="css/redmond/jquery-ui-1.10.3.custom.css"  />	<link rel="stylesheet" type="text/css" href="tablecloth/tablecloth.css" media="screen" />	<link rel="stylesheet" type="text/css" href="font_awesome/css/font-awesome.min.css" />	<link rel="stylesheet" type="text/css" href="css/alertify.css" />	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"  media="all"/>			<link rel="stylesheet" type="text/css" href="css/imprimir_abono.css"  media="all"/>				<script type="text/javascript" src="tablecloth/tablecloth.js"></script>	<script type="text/javascript" src="js/jquery.min.js"></script>	<script type="text/javascript" src="js/bootstrap.min.js"></script>		<script type="text/javascript" src="js/validar.js"></script>	<script type="text/javascript" src="js/alertify.min.js"></script>	<script type="text/javascript">		$( document ).ready(function() {						// var dt = new Date();			// var time = dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();			// $("#txt_hora_abono").val(time);						// $("#txt_fecha_abono").datepicker({			// changeMonth: true,			// changeYear: true,			// onSelect: function(dateText, inst) {			// $("#txt_tarjeta").select();			// }			// });			$('#txt_fecha_abono').focus();									//evita enviar el formulario el presionar enter			$('#form_nueva_cobranza').keypress(function(e){   				if(e.which == 13){					return false;				}							}); 						$( "#txt_abono" ).keyup(function() { 				var saldo_anterior = $( "#txt_saldo_anterior" ).val();				var abono = $( "#txt_abono" ).val();				$( "#txt_saldo_restante" ).val(parseInt(saldo_anterior) - abono);			});							$( "#txt_tarjeta" ).blur(function() {		if($( "#txt_tarjeta" ).val() == ""){						alertify.error("Ingresa una Tarjeta");					}		else{			var tarjeta = $( "#txt_tarjeta" ).val();			$.get("get_saldo_actual.php",  { "tarjeta":tarjeta  } , function(respuesta, status){								if(status =="success"){					console.log(respuesta);					if(respuesta["existe"]){						$("#txt_nombre_cliente").val(respuesta.datos_tarjeta.nombre_cliente);											$("#txt_abono").val(respuesta.datos_tarjeta.cantidad_abono);							$("#txt_saldo_anterior").val(respuesta.datos_tarjeta.saldo_actual);							$("#articulo").val(respuesta.datos_tarjeta.articulo);							$("#txt_abono").focus();							}					else{						alertify.error("Tarjeta No Encontrada");						$("#txt_nombre_cliente").val("");													$("#txt_tarjeta").focus();								$("#txt_tarjeta").select();						}												}			});		}			});						$('#btn_imprimir').click(function(event){				$('#btn_guardar').click();				console.log("Imprimiendo");												$("#fecha_abono").html($("#txt_fecha_abono").val());				$("#hora_abono").html($("#txt_hora_abono").val());				$("#cajero").html($("#select_cobrador").val());				$("#tarjeta").html($("#txt_tarjeta").val());				$("#cliente").html($("#txt_nombre_cliente").val());				$("#saldo_anterior").html($("#txt_saldo_anterior").val());				$("#saldo_restante").html($("#txt_saldo_restante").val());				$("#abono").html($("#txt_abono").val());																if ($("#form_nueva_cobranza").data("valid")){					window.print();				}			});									$('#btn_guardar').click(function(event){				//alert("Guardadno");				event.preventDefault();								if (validar("form_nueva_cobranza")){					$("#form_nueva_cobranza").data("valid", true);					console.log("Valido");					console.log($("#form_nueva_cobranza").data("valid"));					$.post("guardar_cobranza.php", $( "#form_nueva_cobranza" ).serialize(), function(data_return, status){						alertify.success(data_return);																		//regresa todos los valores a 0						function resetForm(status){							if(status =="success"){																$("#txt_tarjeta").val("");								$("#txt_saldo_anterior").val("");								$("#txt_abono").val("");								$("#txt_saldo_restante").val("");								$("#txt_nombre_cliente").val("");																								var dt = new Date();								var time = dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();								$("#txt_hora_abono").val(time);																$("#txt_tarjeta").focus();															}													}											});				}			});  			$("#txt_saldo_restante").keypress(function(e){				if(e.which == 13){					$('#btn_guardar').click();				}			});		}); 	</script></head><body>	<?php		include("header.php");	?>	<div class="contenido hidden-print">		<div class="titulo hidden-print">			Registrar Abono		</div>				<form  action="" method="post" id="form_nueva_cobranza" accept-charset="utf-8">			<div class="row hidden-print">				<div class="col-sm-12">					<table>						<tr>							<td>								Fecha 							</td>							<td>								Cobrador 							</td>							<td>								Hora								</td>							<td>								Tipo de Abono								</td>							<td>								Tarjeta							</td>							<td>								Cliente							</td>							<td>								Saldo Anterior							</td>							<td>								Abono							</td>							<td>								Saldo Restante							</td>							<td>															</td>						</tr>						<tr>							<td >								<input type="text"  id="txt_fecha_abono" name="fecha_abono" size="10" value="<?php echo $fecha_abono;?>" />							</td>							<td  >								<select name="cobrador" id="select_cobrador">									<option value="" <?php echo is_selected("", $cobrador)?> >Elige un Cobrador	</option>									<?php 										$q_cobradores = "SELECT * FROM cobradores ORDER BY nombre_cobrador";										$result_cobradores=mysql_query($q_cobradores,$link) or die("Error en: $q_cobradores  ".mysql_error());																				while($row = mysql_fetch_assoc($result_cobradores)){											$cobrador_db = $row["nombre_cobrador"];																					?>										<option value="<?php echo $cobrador_db;?>" 										<?php echo is_selected($cobrador_db, $cobrador);?> > 											<?php echo $cobrador_db;?> 											</option>										<?php										}									?>									</select>							</td>							<td >								<input type="text"  id="txt_hora_abono" pattern="([01]?[0-9]|2[0-3])(:[0-5][0-9]){2}" 								required="required" placeholder="hh:mm:ss" name="hora_abono" size="10" value="<?php echo $hora_abono;?>" />							</td>							<td >								<select name="tipo_abono" id="tipo_abono">									<option value="Abono" >Abono	</option>									<option value="Enganche" >Enganche	</option>									<option value="Ajuste" >Ajuste	</option>										</select>							</td>							<td >								<input type="text" autofocus  id="txt_tarjeta" name="tarjeta" size="5" value="<?php echo $tarjeta;?>"  />							</td>							<td >								<input type="text"  id="txt_nombre_cliente" name="cliente" size="25"   />							</td>							<td class="form-input">								<input type="text" id="txt_saldo_anterior" readonly name="saldo_anterior" size="10" />							</td>							<td >								<input type="text" id="txt_abono" name="abono"  size="10" value="" />							</td>							<td >								<input type="text" id="txt_saldo_restante" readonly name="saldo_restante" size="10"  />							</td>							<td >															</td>						</tr>					</table>				</div>			</div>			<div class="row">				<div class="col-sm-4 col-sm-offset-8 ">										<button class="btn_add btn btn-success hide" name="guardar" id="btn_guardar">						<i class="fa fa-floppy-o"></i>	Guardar		 					</button>					<button type="button" class="btn_add btn btn-info pull-right"  id="btn_imprimir"> 						<i class="fa fa-print"></i> Guardar	e Imprimir						</button>									</div>			</div>					</form>					</div>		<div class=" ticket58 visible-print-block">		<div class="text-center">			<div id="logo">				<img src="img/logo.png" width="200" height="50"/>			</div>			<small style="font-size: 8px !important;  line-height: 70%;" >				HILARIO ROBERTO LAGUNA LÓPEZ RFC LALH640228EK7 CURP LALH640228HMCGPL02 				Régimen de Incorporación Fiscal<br>				VENTA DE ARTICULOS PARA EL HOGAR  <br>				AV 16 DE SEPTIEMBRE S/N SAN SEBASTIÁN, ZUMPANGO ESTADO DE MEXICO , <BR>				Tel: (01591) 9185428			</small>		</div>		--------------------------------		<div class="fila_ticket">			<span class=" ">				<strong>Tarjeta: </strong>			</span>			<span id="tarjeta" class="pull-right">				123456			</span>		</div>		<div class="fila_ticket">			<span class="">				<strong>Fecha: </strong>			</span>			<span id="fecha_abono" class="pull-right">				<?php echo date("d/m/Y");?>			</span>		</div>		<div class="fila_ticket">			<span class="">				<strong>	Hora: </strong>			</span>			<span id="hora_abono" class="pull-right">							</span>		</div>		------------------------		<div class="fila_ticket">			<span class="">				<strong>	Dia de Cobro: </strong>			</span>			<span id="dia_cobranza" class="pull-right">							</span>		</div>		<div class="fila_ticket">			<span class="">				<strong>Cliente: </strong>			</span>			<span id="cliente" class="pull-right">							</span>		</div>		<div class="fila_ticket">			<span>				<strong>Artículo: </strong>			</span>			<span id="articulo" class="pull-right">			</span>		</div>				<div class="fila_ticket">			<span class="">				<strong>Cajero: </strong>			</span>			<span id="cajero" class="pull-right">							</span>		</div>		<div class="fila_ticket">			<span class="">				<strong>Saldo Anterior: </strong>			</span>			<span id="saldo_anterior" class="pull-right">							</span>		</div>		<div class="fila_ticket">			<span class="">				<strong>Abono: </strong>			</span>			<span id="abono" class="pull-right">							</span>		</div>		<div class="fila_ticket">			<span class="">				<strong>Saldo Restante: </strong>			</span>			<span id="saldo_restante" class="pull-right">							</span> 		</div>		<div class="fila_ticket">				<span class="">				<strong>Fecha Vencim.: </strong>			</span>						<span id="fecha_vencimiento" class="pull-right">							</span>		</div>		<div class="fila_ticket hide" id="fila_atraso">				<span class="">				<strong>Atraso: </strong>			</span>			<span id="semanas_atraso" >			</span>			Semanas.			<br>			<span class="">				<strong>Intereses: </strong>			</span> $ 			<span id="intereses" > 			</span>						<br>		</div>		<div class="fila_ticket">			<strong>Ultimos 3 Abonos: </strong>		</div>		<div class="fila_ticket">			<div id="ultimos_abonos" class="pull-right">							</div>		</div>				</br></br>			Recuerde que los pagos son cada 8 días.</br></br>			Si su cobrador no pasa, reportelo al (01591) 91-8-54-28</br></br>					Exija su comprobante de pago,     cualquier abono entregado sin recibo no sera reconocido por la empresa</br></br>			Si requiere un producto favor de   comunicarse a la Muebleria	</div>	</body></html>