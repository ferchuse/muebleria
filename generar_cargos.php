<?php	include("conexi.php");	$link=Conectarse();		$tarjeta = '9999999'; 		$consulta = "SELECT * FROM ventas WHERE tarjeta = '$tarjeta'";		$result = mysqli_query($link, $consulta);		$fila_venta = mysqli_fetch_assoc($result);			$saldo_inicial = $fila_venta["importe_total"] - $fila_venta["engnache"];		$num_pagos = $saldo_inicial / $fila_venta["cantidad_abono"]; 	?><table border="1">	<thead>		<tr>			<th>Fecha	</th>			<th>Concepto	</th>			<th>Cargo	</th>			<th>Abono	</th>			<th>Saldo	</th>		</tr>	</thead>			<tr>		<td><?php echo $fila_venta["fecha_venta"];?></td>		<td>Venta <?php echo $fila_venta["tarjeta"];?></td>		<td> <?php echo $fila_venta["importe"];?></td>		<td> - </td>		<td> <?php echo $fila_venta["importe"];?></td>	</tr>	<?php		$dias_ingles = ["LUNES" => "monday", "MARTES" => "tuesday", "MIÉRCOLES" => "wednesday", "JUEVES" => "thursday", "VIERNES" => "friday", "SÁBADO" => "saturday", "DOMINGO" => "sunday"];		$meses_cortos = ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"];		$atrasados = 0; 		$acumulado_planeado = 0; 				switch($fila_venta["periodo"]){						case "SEMANAL":			$tamaño_periodo = 1;			$periodo = "week";			break;			case "QUINCENAL":			$tamaño_periodo = 15;  			$periodo = "days";			break;			case "MENSUAL":				$tamaño_periodo = 1;			$periodo = "months";			break;					}				switch($fila_venta["dia_cobranza"]){						case "QUINCENAL":						if(date("j", strtotime($fila_venta["fecha_ventas"])) > 16){				$fecha_inicial = strtotime("first day of next month"); 			}			else{				$fecha_inicial = strtotime(date("Y-m-16",strtotime($fila_venta["fecha_ventas"]) ));			}			break;			case "MENSUAL":			$fecha_inicial = strtotime("first day of next month"); 						break;			default:			$siguiente_dia = $dias_ingles[$fila_venta["dia_cobranza"]];			$fecha_inicial = strtotime("next $siguiente_dia ", strtotime($fila_venta["fecha_ventas"]));					}				$cantidad_pagos = $fila_venta["importe"] / $fila_venta["abono"];		$incremento= $tamaño_periodo;		$fecha_inicial = strtotime(" - $incremento $periodo" , $fecha_inicial);						for ($i = 0; $i <= $cantidad_pagos; $i++) {						$segundos = strtotime(" + $incremento $periodo" , $fecha_inicial);			$acumulado_planeado+= $fila_venta["abono"];			$incremento+= $tamaño_periodo;						$segundos_limite = strtotime(" + 7 days" , $segundos);									if($acumulado_planeado <= $fila_venta["suma_abonos"]){				if($segundos_limite < strtotime("now")){					$estatus_abono = '<i class="text-success fas fa-check"></i>';				}				else {					$estatus_abono = '-';				}			}			else{				if($segundos_limite < strtotime("now")){										$estatus_abono = '<i class="text-danger fas fa-times"></i>';					$atrasados++;									}				else {					$estatus_abono = '-';				}			}									$fecha_cargo = date("Y-m-d", $segundos);			$fecha_limite_pago = date("Y-m-d", $segundos_limite);						$delete = "DELETE FROM cargos WHERE tarjeta = '{$fila_venta["tarjeta"]}'";						mysqli_query($link, $delete);						$insert_cargos = "INSERT INTO cargos SET 			tarjeta = '{$fila_venta["tarjeta"]}',			fecha_cargo = '{$fecha_cargo}',			fecha_limite_pago = '{$fecha_limite_pago}',			monto_cargo = '{$fila_venta["abono"]}' ,			concepto_cargo = '{$fila_venta["tarjeta"]}'						";						 $result = mysqli_query($link, $insert_cargos) or die("Error en $insert_cargos". mysqli_error($link));					?> 						<?php		}						$consulta="SELECT 		fecha_cargo  AS fecha,		concepto_cargo  AS concepto,		monto_cargo  AS cargo,		'-'  AS abono				FROM cargos WHERE  tarjeta = '{$fila_venta["tarjeta"]}'				UNION SELECT 				date(fecha_hora_abono)  AS fecha,		'Abono'  AS concepto,		abono  AS abono,		'-'  AS cargo				FROM abonos				WHERE tarjeta = '{$fila_venta["tarjeta"]}'		";				$result = mysqli_query($link, $consulta) or die("Error en $consulta". mysqli_error($link));						while($fila = mysqli_fetch_assoc($result)){			if($fila["abono"] != '-'){								$saldo+=$fila["abono"];			} 			else{				$saldo-=$fila["cargo"];			}		?>		<tr > 			<td><?php echo $fila["fecha"];?></td>			<td><?php echo $fila["concepto"];?></td>			<td><?php echo $fila["cargo"];?></td>			<td><?php echo $fila["abono"];?></td>			<td><?php echo $saldo;?></td>							</tr>				<?php		}			?>	</tbody><tfoot></tfoot></table>