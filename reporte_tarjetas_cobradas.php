<?php	include "login/login_success.php";	include ("conex.php");	include ("is_selected.php");	$link = Conectarse();	$dias = array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado");	//setlocale(LC_TIME, "es_ES");	//$dia_inicial = $dia_semana["wday"] -1;	//$dia_final = 6 - $dia_semana["wday"] ;		if($_GET["fecha_inicial"]){		$sector = $_GET["sector"];		$fecha_inicial = $_GET["fecha_inicial"];		$fecha_final = $_GET["fecha_final"];	}	else{		$dia_semana = date("w");			$dia_inicial = 5-$dia_semana;		$dia_final = 3 - $dia_semana ;				$fecha_inicial = date("d-m-Y",strtotime("-$dia_inicial days"));		$fecha_final = date("d-m-Y",strtotime("+$dia_final days"));		}?><html xmlns="http://www.w3.org/1999/xhtml"><head>	<title>Reporte de Cobranza </title>	<meta charset="utf-8" />		<link rel="stylesheet" type="text/css" href="css/layout.css" />	<link rel="stylesheet" type="text/css" href="css/layout.css"  media="print"/>			<link rel="stylesheet" type="text/css" href="css/redmond/jquery-ui-1.10.3.custom.css"  />	<link rel="stylesheet" type="text/css" href="tablecloth/tablecloth.css" media="screen" />	 	 	<script type="text/javascript" src="tablecloth/tablecloth.js"></script>	<script type="text/javascript" charset="utf8" src="DataTables-1.10.4/media/js/jquery.js"></script>	<script type="text/javascript" src="js/jquery-ui-1.10.3.custom.js"></script>	<script type="text/javascript" src="js/jquery.ui.datepicker-es.js"></script>		<script>		$( document ).ready(function() {			$(".botonExcel").click(function(event) {					$("#datos_a_enviar").val( $("<div>").append( $("#Exportar_a_Excel").eq(0).clone()).html());					$("#FormularioExportacion").submit();			});						$( "#fecha_inicial" ).datepicker({				changeMonth: true,				changeYear: true,				dateFormat: 'dd-mm-yy'				//yearRange: '1920:2000'			});			$( "#fecha_final" ).datepicker({				changeMonth: true,				changeYear: true,				dateFormat: 'dd-mm-yy'			});																		$( ".borrar").click(function(event) {				if (confirm('¿Esta seguro que desea eliminar?')){					boton= $(this);					$.get('borrar.php', {						borrar: "producto", 							id: boton.attr("id"),						}, function(data){							//alert(data);						boton.closest("tr").fadeOut();					});				}				else{					return false;				}				return false; 			 });			 		});				function validar(){						//alert("Cobrador"+ cobrador);			if ($("#fecha_inicial").val() == ''){				alert("Ingresa una Fecha Inicial") ;				return false;			}			if ($("#fecha_final").val() == ''){				alert("Ingresa una Fecha Final") ;				return false;			}			if ($("#cobrador").val() == ''){				alert("Elige un Cobrador") ;				return false;			}						return true	;			}	</script></head><body><?phpinclude("header.php");?><div class="contenido">	<div class="encabezado_imprimir">		Muebleria Casa Roberto	</div>	<div class='titulo no_imprimir'>Reporte de Tarjetas Cobradas </div>	<div class="no_imprimir" id="div_form">		<form name="form_rep_mes" method="get"  action="" onsubmit="return validar();"	>					<span class="etiqueta">						Fecha Inicial: <input size="10" type="text" name="fecha_inicial" id="fecha_inicial" value="<?php echo $fecha_inicial;?>" />					</span>					<span class="etiqueta">						Fecha Final: <input size="10" type="text" name="fecha_final" id="fecha_final" value="<?php echo $fecha_final;?>" />					</span>					<span class="etiqueta">						Cobrador					</span>					<select name="cobrador">						<option value="">Elige un Cobrador	</option>						<?php 							$q_cobradores = "SELECT * FROM cobradores ORDER BY nombre_cobrador";							$result_cobradores=mysql_query($q_cobradores,$link) or die("Error en: $q_cobradores  ".mysql_error());														while($row = mysql_fetch_assoc($result_cobradores)){								$cobrador_db = $row["nombre_cobrador"];															?>							<option value="<?php echo $cobrador_db;?>" 								<?php echo is_selected($cobrador_db, $cobrador);?> > 								<?php echo $cobrador_db;?> 								</option>							<?php							}							?>					</select>									<span class="etiqueta">					Estatus				</span>				<select name="estatus" id="estatus" >					<option value="">Elige un Estatus	</option>					<?php 					$q_estatus = "SELECT * FROM estatus ";					$result_estatus=mysql_query($q_estatus,$link) or die("Error en: $q_estatus  ".mysql_error());										while($row = mysql_fetch_assoc($result_estatus)){						$estatus = $row["estatus"];											?>					<option value="<?php echo $estatus;?>" > 						<?php echo $estatus;?> 						</option>					<?php					}					?>				</select>									<input class="boton" type="submit" name="buscar_fecha" value="Buscar" />		</form>	</div>	<?php 	if(isset($_GET["buscar_fecha"])){		$cobrador = $_GET["cobrador"];		$estatus = $_GET["estatus"];		$fecha_inicial = $_GET["fecha_inicial"];		$fecha_final = $_GET["fecha_final"];		/* 		$dia_fecha_inicial = date_create_from_format("d/m/Y", $fecha_inicial);		$dia_fecha_inicial = $dia_fecha_inicial->getTimestamp();		$dia_fecha_inicial = date("w", $dia_fecha_inicial);		$dia_fecha_inicial = $dias[$dia_fecha_inicial];				$dia_fecha_final = date_create_from_format("d/m/Y", $fecha_final);		$dia_fecha_final = $dia_fecha_final->getTimestamp();		$dia_fecha_final = date("w", $dia_fecha_final);		$dia_fecha_final = $dias[$dia_fecha_final];		 */				 		//print_r (date_create_from_format("d/m/Y",$fecha_final));				echo "<div class='titulo'>Reporte de Tarjetas Cobradas del : $dia_fecha_inicial $fecha_inicial al $dia_fecha_final $fecha_final  </div>"; 		echo "<div class='titulo'>Cobrador : $cobrador   </div>"; 			?>		<div class='titulo'>Estatus :<?php echo  $estatus;?>   </div>								<div id="cid_4" class="lbl_blanca no_imprimir">			<form action="ficheroExcel.php"  accept-charset="ISO-8859-1" method="post" target="_blank" id="FormularioExportacion">				<p>Exportar a Excel  <img src="img/export_to_excel.gif" class="botonExcel" /></p>				<input type="hidden" id="datos_a_enviar" name="datos_a_enviar" />			</form>		</div>				<div class="btn_imprimir no_imprimir">			<button class="boton" onclick="javascript:window.print();">				Imprimir			</button>		</div>						<?php			$date1=date_create($fecha_inicial);			$date2=date_create($fecha_final);			$diff=date_diff($date1,$date2);						$num_dias = $diff->format("%a") +1;			$dia_inicial = date("j", strtotime($fecha_inicial));			$dia_final = date("j", strtotime($fecha_final));						if($num_dias > 31){				die("<div class = 'titulo'> !ERROR! El intervalo debe ser menor a 1 Mes </div>");			}			echo "dias $num_dias ";			echo "Dia Inicial $dia_inicial ";			echo "Dia Final: $dia_final ";			?>	<table border="1" id="Exportar_a_Excel">									<th>Tarjeta</th>			<th>Cliente</th>			<th>J</th>			<th>V</th>			<th>S</th>			<th>D</th>			<th>L</th>			<th>M</th>			<th>M</th>							<th>J</th>			<th>V</th>			<th>S</th>			<th>D</th>			<th>L</th>			<th>M</th>			<th>M</th>							<th>J</th>			<th>V</th>			<th>S</th>			<th>D</th>			<th>L</th>			<th>M</th>			<th>M</th>									<?php				if(isset($_GET["cobrador"])){			$cobrador = $_GET["cobrador"];		}				$q_tarjetas = "SELECT tarjeta, nombre_cliente, dia_cobranza 			FROM ventas 			WHERE cobrador = '$cobrador' 			AND estatus ='$estatus' 			ORDER BY dia_cobranza";		$result_tarjetas=mysql_query($q_tarjetas,$link) or die("Error en: $q_tarjetas  ".mysql_error());					while($row = mysql_fetch_assoc($result_tarjetas)){				$tarjeta = $row["tarjeta"];				$nombre_cliente = $row["nombre_cliente"];				$dia_cobranza = $row["dia_cobranza"];																			$q_abonos ="					SELECT * FROM 					(SELECT  sum(abono) as lunes FROM abonos 					WHERE DATE(fecha_hora_abono)					BETWEEN str_to_date('$fecha_inicial','%d-%m-%Y') 					AND str_to_date('$fecha_final','%d-%m-%Y')					AND cobrador = '$cobrador' 					AND tarjeta = '$tarjeta'					AND WEEKDAY(DATE(fecha_hora_abono)) = 0) AS lunes,										(SELECT  sum(abono) as martes FROM abonos 					WHERE DATE(fecha_hora_abono)					BETWEEN str_to_date('$fecha_inicial','%d-%m-%Y') 					AND str_to_date('$fecha_final','%d-%m-%Y')					AND cobrador = '$cobrador' 					AND tarjeta = '$tarjeta'					AND WEEKDAY(DATE(fecha_hora_abono)) = 1) AS martes,										(SELECT  sum(abono) as miercoles FROM abonos 					WHERE DATE(fecha_hora_abono)					BETWEEN str_to_date('$fecha_inicial','%d-%m-%Y') 					AND str_to_date('$fecha_final','%d-%m-%Y')					AND cobrador = '$cobrador' 					AND tarjeta = '$tarjeta'					AND WEEKDAY(DATE(fecha_hora_abono)) = 2) AS miercoles,										(SELECT  sum(abono) as jueves FROM abonos 					WHERE DATE(fecha_hora_abono)					BETWEEN str_to_date('$fecha_inicial','%d-%m-%Y') 					AND str_to_date('$fecha_final','%d-%m-%Y')					AND cobrador = '$cobrador' 					AND tarjeta = '$tarjeta'					AND WEEKDAY(DATE(fecha_hora_abono)) = 3) AS jueves,										(SELECT  sum(abono) as viernes FROM abonos 					WHERE DATE(fecha_hora_abono)					BETWEEN str_to_date('$fecha_inicial','%d-%m-%Y') 					AND str_to_date('$fecha_final','%d-%m-%Y')					AND cobrador = '$cobrador' 					AND tarjeta = '$tarjeta'					AND WEEKDAY(DATE(fecha_hora_abono)) = 4) AS viernes,										(SELECT  sum(abono) as sabado FROM abonos 					WHERE DATE(fecha_hora_abono)					BETWEEN str_to_date('$fecha_inicial','%d-%m-%Y') 					AND str_to_date('$fecha_final','%d-%m-%Y')					AND cobrador = '$cobrador' 					AND tarjeta = '$tarjeta'					AND WEEKDAY(DATE(fecha_hora_abono)) = 5) AS sabado,										(SELECT  sum(abono) as domingo FROM abonos 					WHERE DATE(fecha_hora_abono)					BETWEEN str_to_date('$fecha_inicial','%d-%m-%Y') 					AND str_to_date('$fecha_final','%d-%m-%Y')					AND cobrador = '$cobrador' 					AND tarjeta = '$tarjeta'					AND WEEKDAY(DATE(fecha_hora_abono)) = 6) AS domingo	";									$result_abonos=mysql_query($q_abonos,$link) or die("Error en: $q_abonos  ".mysql_error());					while($row = mysql_fetch_assoc($result_abonos)){					$lunes = $row["lunes"];					$martes = $row["martes"];					$miercoles = $row["miercoles"];					$jueves = $row["jueves"];					$viernes = $row["viernes"];					$sabado = $row["sabado"];					$domingo = $row["domingo"];										if($lunes == ''){$lunes = "";}					if($martes == ''){$martes = "";}					if($miercoles == ''){$miercoles = "";}					if($jueves == ''){$jueves = "";}					if($viernes == ''){$viernes = "";}					if($sabado == ''){$sabado = "";}					if($domingo == ''){$domingo = "";}							?>			<tr>								<td>					<?php echo "$tarjeta";?>				</td>				<td>					<?php echo "$nombre_cliente";?>				</td>				<td>					<?php echo "$jueves";?>				</td>				<td>					<?php echo "$viernes";?>				</td>				<td>					<?php echo "$sabado";?>				</td>				<td>					<?php echo "$domingo";?>				</td>				<td>					<?php echo "$lunes";?>				</td>				<td>					<?php echo "$martes";?>				</td>				<td>					<?php echo "$miercoles";?>				</td>							</tr>		<?php			}		}		?>		</table>			<div>			<br>		<br>		Recibe ______________________	</div>	<?php	}	?>		</div></body></html>