<?php	include "login/login_success.php";	include ("conex.php");	include ("is_selected.php");	$link = Conectarse();	$meses = array("ENE","FEB","MAR","ABR","MAY","JUN","JUL", "AGO", "SEP", "OCT", "NOV", "DIC");	$weekdays =  array(		"5" =>"Sábado",		"6" => "Domingo", 		"0" =>"Lunes",		"1" =>"Martes",		"2" =>"Miércoles",		"3" =>"Jueves"		);		if(isset($_GET["year"])){		$year = $_GET["year"];		$cobrador = $_GET["cobrador"];			}	else{		$year = "2017";	}?><!DOCTYPE html><html><head>	<title>Reporte de Cobranza Diaria</title>	<meta charset="utf-8" />	<?php include("styles.php");?>	</head><body><?phpinclude("header.php");?><div class=" container-fluid">	<div class="encabezado_imprimir visible-print">		Muebleria Casa Roberto	</div>	<div class='titulo no_imprimir'>Reporte Comparativo de Cobranza </div>	<div class="no_imprimir row" id="div_form">		<div class="col-sm-12">			<form name="form_rep_mes"  class="form-inline" method="get" action="" >				<span class="form-group">					<label for="fecha_inicial" class="etiqueta">Año: </label>					<select class="form-control" name="year" id="fecha_inicial">						<option 	<?php echo is_selected($year, "2015");?>   value="2015">2015</option>						<option <?php echo is_selected($year, "2016");?> value="2016">2016</option>						<option <?php echo is_selected($year, "2017");?> value="2017">2017</option>					</select>				</span>				<div class="form-group">				<label class="etiqueta">					Cobrador: 				</label>				<select name="cobrador" id="cobrador" class="form-control">									<?php 					$q_cobradores = "SELECT * FROM cobradores ORDER BY nombre_cobrador ";					$result_cobradores=mysql_query($q_cobradores,$link) or die("Error en: $q_cobradores  ".mysql_error());										while($row = mysql_fetch_assoc($result_cobradores)){						$cobrador_db = $row["nombre_cobrador"];											?>					<option value="<?php echo $cobrador_db;?>" 						<?php echo is_selected($cobrador_db, $cobrador);?> > 						<?php echo $cobrador_db;?> 						</option>					<?php					}					?>				</select>			</div>				<button type="submit" class="btn btn-success">					<i class="fa fa-search"></i> Buscar				</button>		</form>		</div>	</div>	<?php 				if(isset($_GET["year"])){		?>		<section>			<h4 class="visible-print">				<div class="row">					<div class="col-sm-6">						Reporte Comparativo de Cobranza Año: <?php echo $year;?> Cobrador:  <?php echo $cobrador;?>					</div>				</div>			</h4>						<div class="btn_imprimir no_imprimir">				<button type="button" class="btn btn-primary" onclick="javascript:window.print();">					<i class="fa fa-print"> </i> Imprimir				</button>			</div>			<?php 				$num_mes = 0;				foreach($meses as $index_mes=>$mes){ 					$totales = array();												$num_mes++;				?>											<div class="row etiqueta">					<div class="col-sm-1">						<h3><?php echo $mes;?></h3>					</div>									<div class="col-sm-11">											<?php 						foreach($weekdays as $index_day=>$weekday){												?>						<div class="col-sm-2">								<h3><?php echo $weekday;?></h3>							<table>							<thead>							<tr>																<th>DIA</th>								<th>COB</th>								<th>IMP</th>															</tr>						</thead>							<tbody>									<?php											$cons =	"		SELECT											*										FROM											(												SELECT													db_date AS fecha												FROM													calendar												WHERE												MONTH (db_date) = '$num_mes'												AND YEAR (db_date) = '$year'												AND WEEKDAY(db_date) = '$index_day'											) AS fechas_todas										LEFT JOIN (											SELECT												DATE(fecha_hora_abono) AS fecha_abono,												count(tarjeta) AS cuentas_cobradas,												SUM(abono) AS importe_cobrado											FROM												abonos											WHERE												WEEKDAY(fecha_hora_abono) = '$index_day'											AND cobrador = '$cobrador'											AND MONTH (fecha_hora_abono) = '$num_mes'											AND YEAR (fecha_hora_abono) = '$year'											GROUP BY												DATE(fecha_hora_abono)										) AS fechas_cobradas ON fechas_cobradas.fecha_abono = fechas_todas.fecha										UNION											SELECT												'TOTAL' AS db_date,												DATE(fecha_hora_abono) AS fecha_abono,												count(tarjeta) AS cuentas_cobradas,												SUM(abono) AS importe_cobrado											FROM												abonos											WHERE											WEEKDAY(fecha_hora_abono) = '$index_day'											AND cobrador = '$cobrador'											AND MONTH (fecha_hora_abono) = '$num_mes'											AND YEAR (fecha_hora_abono) = '$year'";																			$result_totales =  mysql_query($cons,$link) or die("Error en: $cons  ".mysql_error());																					 											$col =1;																						while($fila = mysql_fetch_assoc($result_totales)){												$totales["cobradas"][] = $fila["cuentas_cobradas"];												$totales["importes"][] = $fila["importe_cobrado"];												?>												<tr> 											 													<td>														<?php echo $fila["fecha"] != 'TOTAL' ? date("d", strtotime($fila["fecha"])) : 'TOTAL';?>													</td>													<td class="text-center"><?php echo $fila["cuentas_cobradas"];?></td>													<td class="text-right"><?php echo number_format($fila["importe_cobrado"]);?></td>												</tr>												<?php																							$col++;											}											?>										</tbody>										</table>																		</div>					<?php					}//foreach weekday					?>							<div class="col-sm-2 hide">							<h3> ACUMULADO </h3>								<table>							<thead>							<tr>																<th>COB</th>								<th>IMP</th>															</tr>						</thead>							<tbody>								<?php foreach($totales["cobradas"] as $index => $cobradas_por_dia){?>										<tr> 											 											<td>												<?php echo array_sum($cobradas);?>											</td>										 											<td>												<?php echo array_sum($importes);?>											</td>																					</tr>										<?php																		}									?>								</tbody>								</table>							<pre>									<?php echo var_dump($totales);?>							</pre>						</div>					</div>							</div>		<?php			} // for each mes	}	?></div>	<?php include("scripts.php");?>	<script>	$( document ).ready(function() {		$(".btn_exportar").click(function(){						$(this).closest("section").find("table").tableExport(			{				type:'excel',				tableName:'Registros',				escape:'false'			});		});	}); 	</script></body></html>